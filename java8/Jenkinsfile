node('jdk8_mvn2') {
    checkout scm
    def common = load 'jenkins.d/Jenkinsfile-common.groovy'

    stage('Prepare Maven settings') {
        common.setupMavenSettings()
    }

    stage('Build with Maven 2.2.1 (legacy proof)') {
        dir('java8') {
            echo "=== Building java8 with Maven 3.x ==="
            sh '''
                # $MAVEN2_HOME/bin/mvn -v
                $MAVEN3_HOME/bin/mvn clean install
            '''
        }
    }

    stage('Deploy with Maven 3.9.x (modern upload)') {
        dir('java8') {
            echo "=== Deploying java8 with Maven 3.x ==="
            sh '''
                $MAVEN3_HOME/bin/mvn -v
                $MAVEN3_HOME/bin/mvn deploy -DskipTests
            '''
        }
    }
}
